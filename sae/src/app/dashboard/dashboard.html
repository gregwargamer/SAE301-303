<section class="dashboard-section">
  <div class="dashboard-container">
    <div class="dashboard-header">
      <h2 class="dashboard-title">Statistiques</h2>
      <p class="dashboard-subtitle">Visualisation des données produits et utilisateurs</p>
    </div>
    
    <!-- Date -->
    <div class="date-card">
      <div class="date-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/>
        </svg>
      </div>
      <div class="date-content">
        <span class="date-day">{{ formatDate(currentDate) }}</span>
        <span class="date-time">{{ formatTime(currentDate) }}</span>
      </div>
    </div>
    
    <!-- Statistiques -->
    <div class="stats-cards">
      <!-- % étudiants -->
      <div class="stat-card">
        <div class="stat-icon student">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
            <path d="M505.837,180.418L279.265,76.124c-7.349-3.385-15.177-5.093-23.265-5.093c-8.088,0-15.914,1.708-23.265,5.093 L6.163,180.418C2.418,182.149,0,185.922,0,190.045s2.418,7.896,6.163,9.627l226.572,104.294c7.349,3.385,15.177,5.101,23.265,5.101 c8.088,0,15.916-1.716,23.267-5.101l178.812-82.306v82.881c-7.096,0.8-12.63,6.84-12.63,14.138c0,6.359,4.208,11.864,10.206,13.618 l-12.092,79.791h55.676l-12.09-79.791c5.996-1.754,10.204-7.259,10.204-13.618c0-7.298-5.534-13.338-12.63-14.138v-95.148 l21.116-9.721c3.744-1.731,6.163-5.504,6.163-9.627S509.582,182.149,505.837,180.418z"/>
            <path d="M256,346.831c-11.246,0-22.143-2.391-32.386-7.104L112.793,288.71v101.638 c0,22.314,67.426,50.621,143.207,50.621c75.782,0,143.209-28.308,143.209-50.621V288.71l-110.827,51.017 C278.145,344.44,267.25,346.831,256,346.831z"/>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value">{{ stats?.studentPercentage || 0 }}%</span>
          <span class="stat-label">Étudiants inscrits</span>
        </div>
      </div>
      
      <!-- Panier moyen -->
      <div class="stat-card">
        <div class="stat-icon cart">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6.29977 5H21L19 12H7.37671M20 16H8L6 3H3M9 20C9 20.5523 8.55228 21 8 21C7.44772 21 7 20.5523 7 20C7 19.4477 7.44772 19 8 19C8.55228 19 9 19.4477 9 20ZM20 20C20 20.5523 19.5523 21 19 21C18.4477 21 18 20.5523 18 20C18 19.4477 18.4477 19 19 19C19.5523 19 20 19.4477 20 20Z"/>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value">{{ stats?.avgCart || 0 }}€</span>
          <span class="stat-label">Panier moyen</span>
        </div>
      </div>
      
      <!-- nbre d'utilisateurs -->
      <div class="stat-card">
        <div class="stat-icon users">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 7C9.65685 7 11 5.65685 11 4C11 2.34315 9.65685 1 8 1C6.34315 1 5 2.34315 5 4C5 5.65685 6.34315 7 8 7Z"/>
            <path d="M14 12C14 10.3431 12.6569 9 11 9H5C3.34315 9 2 10.3431 2 12V15H14V12Z"/>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value">{{ stats?.totalUsers || 0 }}</span>
          <span class="stat-label">Utilisateurs</span>
        </div>
      </div>
      
      <!-- nbre total de commandes -->
      <div class="stat-card">
        <div class="stat-icon orders">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12.052 1.25H11.948C11.0495 1.24997 10.3003 1.24995 9.70552 1.32991C9.07773 1.41432 8.51093 1.59999 8.05546 2.05546C7.59999 2.51093 7.41432 3.07773 7.32991 3.70552C7.27259 4.13189 7.25637 5.15147 7.25179 6.02566C5.22954 6.09171 4.01536 6.32778 3.17157 7.17157C2 8.34315 2 10.2288 2 14C2 17.7712 2 19.6569 3.17157 20.8284C4.34314 22 6.22876 22 9.99998 22H14C17.7712 22 19.6569 22 20.8284 20.8284C22 19.6569 22 17.7712 22 14C22 10.2288 22 8.34315 20.8284 7.17157C19.9846 6.32778 18.7705 6.09171 16.7482 6.02566C16.7436 5.15147 16.7274 4.13189 16.6701 3.70552C16.5857 3.07773 16.4 2.51093 15.9445 2.05546C15.4891 1.59999 14.9223 1.41432 14.2945 1.32991C13.6997 1.24995 12.9505 1.24997 12.052 1.25ZM15.2479 6.00188C15.2434 5.15523 15.229 4.24407 15.1835 3.9054C15.1214 3.44393 15.0142 3.24644 14.8839 3.11612C14.7536 2.9858 14.5561 2.87858 14.0946 2.81654C13.6116 2.7516 12.964 2.75 12 2.75C11.036 2.75 10.3884 2.7516 9.90539 2.81654C9.44393 2.87858 9.24644 2.9858 9.11612 3.11612C8.9858 3.24644 8.87858 3.44393 8.81654 3.9054C8.771 4.24407 8.75661 5.15523 8.75208 6.00188C9.1435 6 9.55885 6 10 6H14C14.4412 6 14.8565 6 15.2479 6.00188ZM12 9.25C12.4142 9.25 12.75 9.58579 12.75 10V10.0102C13.8388 10.2845 14.75 11.143 14.75 12.3333C14.75 12.7475 14.4142 13.0833 14 13.0833C13.5858 13.0833 13.25 12.7475 13.25 12.3333C13.25 11.9493 12.8242 11.4167 12 11.4167C11.1758 11.4167 10.75 11.9493 10.75 12.3333C10.75 12.7174 11.1758 13.25 12 13.25C13.3849 13.25 14.75 14.2098 14.75 15.6667C14.75 16.857 13.8388 17.7155 12.75 17.9898V18C12.75 18.4142 12.4142 18.75 12 18.75C11.5858 18.75 11.25 18.4142 11.25 18V17.9898C10.1612 17.7155 9.25 16.857 9.25 15.6667C9.25 15.2525 9.58579 14.9167 10 14.9167C10.4142 14.9167 10.75 15.2525 10.75 15.6667C10.75 16.0507 11.1758 16.5833 12 16.5833C12.8242 16.5833 13.25 16.0507 13.25 15.6667C13.25 15.2826 12.8242 14.75 12 14.75C10.6151 14.75 9.25 13.7903 9.25 12.3333C9.25 11.143 10.1612 10.2845 11.25 10.0102V10C11.25 9.58579 11.5858 9.25 12 9.25Z"/>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value">{{ stats?.totalOrders || 0 }}</span>
          <span class="stat-label">Commandes</span>
        </div>
      </div>
    </div>
    
    <!-- chiffre d'affaires -->
    <div class="chart-card revenue-card">
      <div class="chart-card-header">
        <div class="chart-icon revenue">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
            <path d="M12.32 8a3 3 0 0 0-2-.7H5.63A1.59 1.59 0 0 1 4 5.69a2 2 0 0 1 0-.25 1.59 1.59 0 0 1 1.63-1.33h4.62a1.59 1.59 0 0 1 1.57 1.33h1.5a3.08 3.08 0 0 0-3.07-2.83H8.67V.31H7.42v2.3H5.63a3.08 3.08 0 0 0-3.07 2.83 2.09 2.09 0 0 0 0 .25 3.07 3.07 0 0 0 3.07 3.07h4.74A1.59 1.59 0 0 1 12 10.35a1.86 1.86 0 0 1 0 .34 1.59 1.59 0 0 1-1.55 1.24h-4.7a1.59 1.59 0 0 1-1.55-1.24H2.69a3.08 3.08 0 0 0 3.06 2.73h1.67v2.27h1.25v-2.27h1.7a3.08 3.08 0 0 0 3.06-2.73v-.34A3.06 3.06 0 0 0 12.32 8z"/>
          </svg>
        </div>
        <div class="chart-header-content">
          <h3 class="chart-title">Chiffre d'affaires mensuel</h3>
          @if (revenueData) {
            <span class="revenue-total">Total {{ selectedYear }}: {{ revenueData.total_revenue | number:'1.2-2' }} €</span>
          }
        </div>
        
        <!-- selecteur d'année -->
        <div class="year-selector">
          @for (year of availableYears; track year) {
            <button 
              class="year-btn" 
              [class.active]="year === selectedYear"
              [disabled]="revenueLoading"
              (click)="changeYear(year)">
              {{ year }}
            </button>
          }
        </div>
      </div>
      
      <!-- ecran de chargement -->
      @if (revenueLoading) {
        <div class="chart-loading">
          <div class="loading-spinner"></div>
        </div>
      }
      
      <div class="chart-wrapper revenue-wrapper">
        <canvas #revenueChart></canvas>
      </div>
    </div>
    
    <!-- Répartition par catégories -->
    <div class="dashboard-grid">
      <div class="chart-card">
        <div class="chart-card-header">
          <div class="chart-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 32" fill="currentColor">
              <path d="M14,0 L12,0 C10.896,0 10,0.896 10,2 L10,30 C10,31.104 10.896,32 12,32 L14,32 C15.104,32 16,31.104 16,30 L16,2 C16,0.896 15.104,0 14,0 L14,0 Z M24,16 L22,16 C20.896,16 20,16.896 20,18 L20,30 C20,31.104 20.896,32 22,32 L24,32 C25.104,32 26,31.104 26,30 L26,18 C26,16.896 25.104,16 24,16 L24,16 Z M4,9 L2,9 C0.896,9 0,9.896 0,11 L0,30 C0,31.104 0.896,32 2,32 L4,32 C5.104,32 6,31.104 6,30 L6,11 C6,9.896 5.104,9 4,9 L4,9 Z"/>
            </svg>
          </div>
          <h3 class="chart-title">Répartition par catégorie</h3>
        </div>
        <div class="chart-wrapper">
          <canvas #pie></canvas>
        </div>
      </div>
      
      <!-- Produit par catégories -->
      <div class="chart-card">
        <div class="chart-card-header">
          <div class="chart-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 32" fill="currentColor">
              <path d="M14,0 L12,0 C10.896,0 10,0.896 10,2 L10,30 C10,31.104 10.896,32 12,32 L14,32 C15.104,32 16,31.104 16,30 L16,2 C16,0.896 15.104,0 14,0 L14,0 Z M24,16 L22,16 C20.896,16 20,16.896 20,18 L20,30 C20,31.104 20.896,32 22,32 L24,32 C25.104,32 26,31.104 26,30 L26,18 C26,16.896 25.104,16 24,16 L24,16 Z M4,9 L2,9 C0.896,9 0,9.896 0,11 L0,30 C0,31.104 0.896,32 2,32 L4,32 C5.104,32 6,31.104 6,30 L6,11 C6,9.896 5.104,9 4,9 L4,9 Z"/>
            </svg>
          </div>
          <h3 class="chart-title">Produits par catégorie</h3>
        </div>
        <div class="chart-wrapper">
          <canvas #bar></canvas>
        </div>
      </div>
    </div>
  </div>
</section>
